import{_ as h,C as l,o as i,c as k,a0 as a,b as p,w as n,a as e,E as r,a1 as E}from"./chunks/framework.CSGB4SNl.js";const b=JSON.parse('{"title":"01 多线程初阶：解谜多线程世界","description":"","frontmatter":{},"headers":[],"relativePath":"java/concurrent/concurrent-01.md","filePath":"java/concurrent/concurrent-01.md"}'),d={name:"java/concurrent/concurrent-01.md"};function g(o,s,y,c,F,u){const t=l("Mermaid");return i(),k("div",null,[s[1]||(s[1]=a(`<h1 id="_01-多线程初阶-解谜多线程世界" tabindex="-1">01 多线程初阶：解谜多线程世界 <a class="header-anchor" href="#_01-多线程初阶-解谜多线程世界" aria-label="Permalink to &quot;01 多线程初阶：解谜多线程世界&quot;">​</a></h1><p>在日常开发中，你是否曾遇到这样的情景：应用程序需要执行多个任务，但你希望它们能够同时运行，以提高性能和响应性。这正是多线程编程的核心价值所在。</p><p>在本文中，我们将学习 Java 多线程编程的基础知识，包括线程的创建、使用、生命周期以及线程安全产生的原因。</p><h2 id="一、线程创建与启动" tabindex="-1">一、线程创建与启动 <a class="header-anchor" href="#一、线程创建与启动" aria-label="Permalink to &quot;一、线程创建与启动&quot;">​</a></h2><p>线程是轻量级的，<strong>共享相同的进程内存空间</strong>。在 Java 中，线程可以使用 <code>java.lang.Thread</code> 类来创建和管理。</p><h3 id="_1-实现-runnable-接口" tabindex="-1">1. 实现 Runnable 接口 <a class="header-anchor" href="#_1-实现-runnable-接口" aria-label="Permalink to &quot;1. 实现 Runnable 接口&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ThreadRunnableTest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Thread thread </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;测试线程&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Task</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Runnable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;线程运行，线程名称为:&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>调用 <code>start</code> 方法后，主线程会开启一条子线程去执行任务，主线程继续向下执行，两者并行执行。</p><h3 id="_2-实现-callable-接口-有返回值" tabindex="-1">2. 实现 Callable 接口（有返回值） <a class="header-anchor" href="#_2-实现-callable-接口-有返回值" aria-label="Permalink to &quot;2. 实现 Callable 接口（有返回值）&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ThreadCallableTest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Exception {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        FutureTask&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; stringFutureTask </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FutureTask&lt;&gt;(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TaskReturn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Thread thread </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(stringFutureTask);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;测试线程&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(stringFutureTask.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TaskReturn</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Callable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;我被线程【%s】执行了&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>Callable</code> 无法直接传递到 <code>Thread</code> 中，需要使用 <code>FutureTask</code> 来包装。<code>FutureTask</code> 的 <code>get</code> 方法可以获取异步任务的执行结果。</p><blockquote><p><strong>主线程与子线程</strong>：点击运行后，执行 <code>main</code> 方法的线程称为<strong>主线程</strong>，从 <code>main</code> 方法中创建的线程称为<strong>子线程</strong>。</p></blockquote><h2 id="二、线程的主要参数与-api" tabindex="-1">二、线程的主要参数与 API <a class="header-anchor" href="#二、线程的主要参数与-api" aria-label="Permalink to &quot;二、线程的主要参数与 API&quot;">​</a></h2><h3 id="_1-优先级" tabindex="-1">1. 优先级 <a class="header-anchor" href="#_1-优先级" aria-label="Permalink to &quot;1. 优先级&quot;">​</a></h3><p>线程的优先级是一个整数值（1-10），1 表示最低优先级，10 表示最高优先级。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setPriority</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Thread.MAX_PRIORITY); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置为最高优先级</span></span></code></pre></div><p><strong>注意</strong>：线程优先级依赖于底层操作系统支持，不保证严格按照优先级顺序执行，且过度依赖可能导致不可预测的结果。</p><p><strong>常见问题</strong>：</p><ul><li><strong>优先级反转</strong>：低优先级线程持有锁后，高优先级线程等待时被阻塞</li><li><strong>饥饿</strong>：高优先级线程长期占用资源，低优先级线程无法获得执行机会</li></ul><h3 id="_2-线程名称" tabindex="-1">2. 线程名称 <a class="header-anchor" href="#_2-线程名称" aria-label="Permalink to &quot;2. 线程名称&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;测试线程&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置线程名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 获取当前线程名称</span></span></code></pre></div><p>线程名称在排查问题（如死锁、系统变慢）时非常重要，可以使用 <code>jconsole</code>、<code>jstack</code> 等 JVM 工具监控。</p><h3 id="_3-守护线程" tabindex="-1">3. 守护线程 <a class="header-anchor" href="#_3-守护线程" aria-label="Permalink to &quot;3. 守护线程&quot;">​</a></h3><p>守护线程的生命周期随主线程结束而终止，用于执行后台任务（如垃圾回收、定时任务、监控等）。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Thread thread </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setDaemon</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置为守护线程</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><p><strong>守护线程 vs 工作线程</strong>：</p><ul><li><strong>守护线程</strong>：主线程执行完毕，守护线程立即停止</li><li><strong>工作线程</strong>：JVM 会等待所有工作线程结束后才停止</li></ul><p><strong>注意</strong>：守护线程可能来不及执行资源回收（如关闭 JDBC 连接），需谨慎使用。</p><h3 id="_4-停止线程" tabindex="-1">4. 停止线程 <a class="header-anchor" href="#_4-停止线程" aria-label="Permalink to &quot;4. 停止线程&quot;">​</a></h3><p><strong>不推荐使用 <code>thread.stop()</code></strong>，会导致资源不释放。</p><p>推荐使用 <code>interrupt</code> 方法请求线程停止：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StopThreadTest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> InterruptedException {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Thread thread </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;测试线程&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        TimeUnit.SECONDS.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">interrupt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 发出停止信号</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Task</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Runnable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isInterrupted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;我执行了&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>interrupt</code> 方法会在线程等待条件时触发 <code>InterruptedException</code> 异常，需配合循环检测中断信号来终止线程。</p><h2 id="三、线程生命周期和状态" tabindex="-1">三、线程生命周期和状态 <a class="header-anchor" href="#三、线程生命周期和状态" aria-label="Permalink to &quot;三、线程生命周期和状态&quot;">​</a></h2><p>Java 线程的生命周期包括以下状态：</p><table tabindex="0"><thead><tr><th>状态</th><th>说明</th></tr></thead><tbody><tr><td><strong>New</strong></td><td>线程对象已创建，但尚未启动</td></tr><tr><td><strong>Runnable</strong></td><td>线程已准备好运行，等待 CPU 时间片</td></tr><tr><td><strong>Running</strong></td><td>线程获得 CPU 时间片并开始执行</td></tr><tr><td><strong>Blocked</strong></td><td>线程被阻塞，等待锁或其他条件</td></tr><tr><td><strong>Waiting</strong></td><td>线程等待其他线程通知继续执行</td></tr><tr><td><strong>Timed Waiting</strong></td><td>线程等待一段时间后自动唤醒</td></tr><tr><td><strong>Terminated</strong></td><td>线程生命周期结束</td></tr></tbody></table><p><strong>状态转换图</strong>：</p>`,37)),(i(),p(E,null,{default:n(()=>[r(t,{id:"mermaid-186",class:"mermaid my-class",graph:"stateDiagram-v2%0A%20%20%20%20%5B*%5D%20--%3E%20New%3A%20%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E5%AF%B9%E8%B1%A1%0A%20%20%20%20New%20--%3E%20Runnable%3A%20start()%0A%20%20%20%20Runnable%20--%3E%20Running%3A%20%E8%8E%B7%E5%BE%97CPU%E6%97%B6%E9%97%B4%E7%89%87%0A%20%20%20%20Running%20--%3E%20Blocked%3A%20%E7%AD%89%E5%BE%85%E9%94%81%0A%20%20%20%20Running%20--%3E%20Waiting%3A%20wait()%0A%20%20%20%20Running%20--%3E%20Timed_Waiting%3A%20sleep()%0A%20%20%20%20Blocked%20--%3E%20Runnable%3A%20%E8%8E%B7%E5%BE%97%E9%94%81%0A%20%20%20%20Waiting%20--%3E%20Runnable%3A%20notify%2FnotifyAll%0A%20%20%20%20Timed_Waiting%20--%3E%20Runnable%3A%20%E6%97%B6%E9%97%B4%E5%88%B0%E6%88%96notify%0A%20%20%20%20Running%20--%3E%20Terminated%3A%20%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E5%AE%8C%E6%AF%95%0A"})]),fallback:n(()=>[...s[0]||(s[0]=[e(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=a('<h2 id="四、竞态条件和临界区" tabindex="-1">四、竞态条件和临界区 <a class="header-anchor" href="#四、竞态条件和临界区" aria-label="Permalink to &quot;四、竞态条件和临界区&quot;">​</a></h2><p><strong>并发安全问题</strong>的产生源于多线程同时访问共享资源，且操作顺序敏感。</p><blockquote><p><strong>小故事</strong>：面包店的小明雇佣了两个助手小红和小绿做蛋糕。第三步&quot;添加奶油和装饰&quot;需要按顺序完成，但由于两人同时操作，导致蛋糕做砸了。</p><p><strong>解决方案</strong>：引入规则——同时只有一人能操作最后一步。这个规则就是<strong>锁</strong>！</p></blockquote><p><strong>关键概念</strong>：</p><ul><li><strong>临界区</strong>：共享资源或代码段，多线程同时访问会产生问题</li><li><strong>竞态条件</strong>：多个线程同时以不同顺序访问临界区</li><li><strong>锁</strong>：保证同一时刻只有一个线程能访问临界区</li></ul><h2 id="五、总结" tabindex="-1">五、总结 <a class="header-anchor" href="#五、总结" aria-label="Permalink to &quot;五、总结&quot;">​</a></h2><p>线程是提升服务器资源利用率的关键工具。在本节中，我们学习了：</p><ul><li>线程的创建方式（<code>Runnable</code>、<code>Callable</code>）</li><li>线程的参数（优先级、名称、守护线程）</li><li>线程的停止方法（<code>interrupt</code>）</li><li>线程的生命周期和状态</li><li>并发安全问题的产生原因（竞态条件、临界区）</li></ul><p>下一节，我们将学习如何合理、高效、安全地使用线程。</p>',9))])}const B=h(d,[["render",g]]);export{b as __pageData,B as default};
